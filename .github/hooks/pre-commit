#!/bin/sh
set -e

# 1) staged 파일 중 JS/TS 계열만 판별
all_files=$(git diff --cached --name-only --diff-filter=ACM)
js_files=$(printf '%s\n' "$all_files" | grep -E '\.(js|ts|jsx|tsx)$' || true)

# 2) 린트 검사 대상인 파일이 없으면 종료
if [ -z "$js_files" ]; then
  exit 0
fi

echo "[pre-commit] ⏳ Checking lint for staged files..."

# 3) lint 검사 수행
if ! pnpm exec eslint --fix -- $js_files; then
  echo "[pre-commit] ❌ Lint errors remain after fixing. Commit aborted."
  exit 1
fi

# 4) 수정된 파일 다시 스테이징
printf '%s\n' $js_files | xargs git add

echo "[pre-commit] ✅ Lint passed. Proceeding with commit."
exit 0
